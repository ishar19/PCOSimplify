<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="../favicon-16x16.png" />
    <title>PCOSimplify</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=ZCOOL+QingKe+HuangYou&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="../styles/stories.css">
  </head>
  <body>
   <div>  <nav class="navbar">
      <p class="logo">PCOSimplify</p>
    <label class="navbar-toggle" id="js-navbar-toggle" for="chkToggle">
            <i style="color:white" class="fa fa-bars"></i>
        </label>
    <input type="checkbox" id="chkToggle"></input>
    <ul class="main-nav" id="js-menu">
      <li>
        <a href="../index.html" class="nav-links">Home</a>
      </li>
      <li>
        <a href="./explore.html"   class="nav-links">Explore</a>
      </li>
      <li>
        <a href="./diet.html" class="nav-links">Diet</a>
      </li>
      <li>
        <a href="./stories.html" id="current" class="nav-links">Your Stories</a>
      </li>
      <li class="signin">
        <a href="./login.html" class="login nav-links">Login/Register</a>
      </li>
      <li class="signout"><a href="#" class=" nav-links">Signout</a></li>
    </ul>
  </nav></div>
    <h1>Share your story</h1>
    <section>
      <div class="main-container">
        <ul class="grid-wrapper">
          <!-- <li>
            item 1
            <p><a class="cta" href="#item1">Read More</a></p>
            <div id="item1" class="modaloverlay">
              <div class="modal">
                <a href="#close" class="close">&times;</a>
                <div class="inner">
                  <h1 class="heading">Story Heading</h1>
                  <p class="story">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit.
                  </p>
                  <h6 class="author">-writer</h6>
                </div>
              </div>
            </div>
          </li> -->
          <!-- <li>item 2
            <p><a class="cta" href="#item2">Read More</a></p>
            <div id="item2" class="modaloverlay">
              <div class="modal">
                <a href="#close" class="close">&times;</a>
                <div>
                  <h1 class="heading">Story Heading</h1>
                  <p class="story">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit.
                  </p>
                  <h6 class="author">-writer</h6>
                </div>
              </div>
            </div>
          </li> -->
        </ul>
      </div>
      <div class="form">
        <form action="#">
                    <input autocomplete="off" class="formElement" type="text" id="name" placeholder="name">
                    <input autocomplete="off" class="formElement" type="text" id="heading" placeholder="heading">
                    <textarea autocomplete="off" class="formElement" name="" rows="" cols="200" id="body" placeholder="your story"></textarea>
                    <button id="share">Share</button>
        </form>
      </div>
    </section>
    <footer>
    <h4>Mail us @<a href="mailto:pcosimplify@gmail.com">PCOSimplify team</a></h4>
  </footer>
  </body>
</html>

<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.9/firebase-app.js'
  const firebaseConfig = {
    apiKey: 'AIzaSyBGPNWZQ0NhfIJZ3AvdU0xp89fte8zfM3s',
    authDomain: 'gdsc-27141.firebaseapp.com',
    databaseURL: 'https://gdsc-27141-default-rtdb.firebaseio.com',
    projectId: 'gdsc-27141',
    storageBucket: 'gdsc-27141.appspot.com',
    messagingSenderId: '701196602653',
    appId: '1:701196602653:web:afc79c572a3929a19fa5f4',
    measurementId: 'G-755Y8K0P37',
  }
  const app = initializeApp(firebaseConfig)
  import {
    getDatabase,
    ref,
    set,
    child,
    get,
    update,
    remove,
  } from 'https://www.gstatic.com/firebasejs/9.6.9/firebase-database.js'
  const db = getDatabase()
   import { collection, doc, setDoc, getFirestore, addDoc, updateDoc, serverTimestamp, getDocs } from "https://www.gstatic.com/firebasejs/9.6.9/firebase-firestore.js"; 
  const storedb = getFirestore(app);
  const auth = getAuth(app)
  const user = auth.currentUser
  import {
    getAuth,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    GoogleAuthProvider,
    signInWithPopup,
    signOut,
    onAuthStateChanged,
    browserSessionPersistence,
    setPersistence,
  } from 'https://www.gstatic.com/firebasejs/9.6.9/firebase-auth.js'
  onAuthStateChanged(auth, (user) => {
    if (user) {
      const uid = user.uid
      const email = user.email
      console.log('State chnage')
      console.log(uid, email)
      const login = document.querySelector('.login')
      login.style.display = 'none';
    } else {
      console.log('state change')
      console.log('User is not signed')
      const signout = document.querySelector('.signout')
      signout.style.display = 'none';
    }
  })  
  const signout = document.querySelector('.signout')
  signout.addEventListener('click', function (e) {
    signOut(auth)
      .then(() => {
        // Sign-out successful.
        console.log(auth.currentUser)
        console.log('signed out')
        const login = document.querySelector('.login')
      login.style.display = 'block';
      })
      .catch((error) => {
        // An error happened.
      })
  })   
  const submit = document.getElementById('share')
  let name = document.getElementById('name');
  let title = document.getElementById('heading');
  let body = document.getElementById('body');
  submit.addEventListener('click',function(e) {
   name = name.value;
   body = body.value;
   title = title.value;
  var newDocRef = doc(collection(storedb,"stories"));
  // console.log(name,body,title);
  setDoc(newDocRef,{
    name:`${name}`,
    body:`${body}`,
    title:`${title}`,
    id:newDocRef.id,
    timestamp:serverTimestamp()
  }).then(function (result) {
    alert('story successfully added');
    window.location.reload();
  })
  })
  const querySnapshot =  getDocs(collection(storedb, "stories"));
  // const story = document.getElementsByClassName('story')
  const grid = document.querySelector('.grid-wrapper')
  let num = 0;
  let count =0;
  querySnapshot.then(function(doc){
    doc.forEach((data)=>{
    let li = document.createElement("li");
    let p = document.createElement("p");
    let a = document.createElement("a");
    a.classList.add('cta');
    a.setAttribute("href",`#item${num}`)
    a.innerText ="Read more";
    p.appendChild(a);
    li.innerText=data.data().title;

    const storybody = document.createElement("p")
    const modaloverlay = document.createElement("div")
    const modal = document.createElement("div");
    const inner = document.createElement("div")
    const close = document.createElement("a")
    const heading = document.createElement("h1")
    const author = document.createElement("h6")
    modaloverlay.classList.add('modaloverlay')
    modaloverlay.setAttribute("id",`item${num}`)
    modal.classList.add('modal')
    close.classList.add("close")
    close.innerHTML ='&times;'
    close.setAttribute("href","#close")
    inner.classList.add('inner')
    heading.classList.add('heading')
    // heading.innerHTML ="hii"
    storybody.classList.add('story')
    // storybody.innerHTML ="hi"
    author.classList.add('author')
    author.innerHTML =""
    modaloverlay.appendChild(modal)
    modal.append(close,inner)
    inner.append(heading, author, storybody)
    li.append(p,modaloverlay)
    grid.append(li);
    num+=1;
    // console.log(data.id, " => ", data.data().body);
    author.innerHTML="by "+"-"+" "+data.data().name
    storybody.innerText=data.data().body;
    
    })
  })
</script>   
